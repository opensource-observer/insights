# Ralph Progress Log
Started: Thu Jan 22 08:23:13 EST 2026

## Codebase Patterns
- Use `/Users/cerv1/GitHub/insights/.venv/bin/marimo` for marimo commands (not global marimo)
- Attribution calculation is in `calculate_attribution()` function around line 1211
- ATTRIBUTION_BUCKETS = [0.01, 0.02, 0.05, 0.10, 0.20, 0.50, 1.0]
- OP_PRICE_USD = 0.35 for USD conversions

---

## 2026-01-22 - US-026
- **What was implemented**: Fixed attribution calculation math bug
- **Root cause**: `round_to_bucket()` function was returning 100% (buckets[-1]) for values smaller than the minimum bucket (1%) because the function didn't handle the case where value < buckets[0]
- **Fix applied**: Added check `if value < buckets[0]: return buckets[0]` to handle small values
- **Files changed**: s8-strategic-insights.py
- **Learnings for future iterations:**
  - The `round_to_bucket` function must handle values below the minimum bucket - always check edge cases
  - Test with extreme values (very small, very large) to catch rounding bugs
  - Debug logging is helpful - keep the `[Attribution Debug]` print statements for verification
  - Python operator precedence: `x if condition else y` has lower precedence than `or`, so `A or B if C else D` parses as `A or (B if C else D)`
---
