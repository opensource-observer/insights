# Developer Data Portal

A dashboard application that serves marimo notebooks through a Next.js interface with sidebar navigation.

## Structure

- **Notebooks**: Marimo notebooks (`.py` files) organized by category:
  - Root level: `home.py`, `quick-start.py`, `publications.py`
  - `data/` - Data sources, models, metric definitions, and agent workflows
    - `sources/` - OSS Directory, Open Dev Data, GitHub Archive
    - `models/` - Developers, Repositories, Ecosystems, Events, Timeseries Metrics
    - `metric-definitions/` - Activity, Alignment, Lifecycle
    - `agent-workflows.py`
  - `insights/` - Developer Activity, Developer Lifecycle, Developer Retention
- **Next.js App**: Web interface in the `app/` directory that serves notebooks via iframes

## Getting Started

### Prerequisites

- Node.js 20+ and pnpm (or npm)
- uv (Python package manager)
- OSO API key (get it from https://opensource.observer)

### Setup

1. **Set up environment variables:**
   ```bash
   # Copy the example env file
   cp .env.example .env
   # Edit .env and add your OSO API key
   # OSO_API_KEY=your_actual_api_key_here
   ```
   
   The `.env` file is already in `.gitignore` so it won't be committed to git.

2. **Install Python dependencies with uv:**
   ```bash
   uv sync
   # This creates a .venv and installs marimo, uvicorn, and pyoso
   ```

3. **Install Next.js dependencies:**
   ```bash
   cd app
   pnpm install  # or npm install
   ```

5. **Start the development servers:**

   You can start both the Marimo server and the Next.js app with a single command:
   ```bash
   cd app
   pnpm dev:all  # or npm run dev:all
   ```

   Alternatively, you can run them separately in two terminals:

   **Terminal 1 (Marimo):**
   ```bash
   # From inside the ddp directory
   uv run python serve_notebooks.py
   ```

   **Terminal 2 (Next.js):**
   ```bash
   cd app
   pnpm dev  # or npm run dev
   ```

   **Note:** Make sure marimo is running before starting the Next.js app if running separately, otherwise the iframes won't be able to load the notebooks.

6. **Access the dashboard:**
   - Next.js app: http://localhost:3000
   - Marimo server: http://localhost:8000

## Notebook Structure

Each notebook follows a standardized template structure:

```python
import marimo

__generated_with = "0.18.4"
app = marimo.App(width="full")

@app.cell
def setup_pyoso():
    # This code sets up pyoso to be used as a database provider for this notebook
    # This code is autogenerated. Modification could lead to unexpected results :)
    import pyoso
    import marimo as mo
    pyoso_db_conn = pyoso.Client().dbapi_connection()
    return mo, pyoso_db_conn

# Additional cells for content...

if __name__ == "__main__":
    app.run()
```

**Key elements:**
- `__generated_with = "0.18.4"` - Marimo version
- `app = marimo.App(width="full")` - Full-width layout for better data visualization
- `setup_pyoso()` - Standardized database connection setup
- Returns both `mo` and `pyoso_db_conn` for use in other cells

## Navigation

The sidebar navigation matches the following structure:
- Home
- Quick Start
- Publications
- Data
  - Sources (OSS Directory, Open Dev Data, GitHub Archive)
  - Models (Developers, Repositories, Ecosystems, Events, Timeseries Metrics)
  - Metric Definitions (Activity, Alignment, Lifecycle)
  - Agent Workflows
- Insights
  - Developer Activity
  - Developer Lifecycle
  - Developer Retention

## Source Notebooks

The source notebooks (OSS Directory, Open Dev Data, GitHub Archive) include enhanced features:

- **SQL Snippets**: Each table preview includes a copy-able SQL query showing all columns, formatted with one column per line
- **Table Previews**: Interactive accordion displays showing table structure, row counts, and sample data
- **ID Column Formatting**: Integer ID columns are automatically formatted without decimal places for better readability

These notebooks serve as templates for populating other sections of the portal.

## Configuration

The `MarimoIframe` component defaults to `localhost:8000`. To change the marimo server port, you can modify the component or pass a `marimoPort` prop.

## Development

- Notebooks are located in the root `community/ddp/` directory
- Next.js pages are in `app/app/` following the Next.js App Router structure
- Components are in `app/components/`
- The sidebar navigation is defined in `app/components/Sidebar.tsx`
